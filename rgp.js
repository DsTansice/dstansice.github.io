let rm={};rm.stopdragimg=$("img"),rm.stopdragimg.on("dragstart",(function(){return!1})),rm.showRightMenu=function(e,n=0,t=0){let i=$("#rightMenu");i.css("top",n+"px").css("left",t+"px"),e?(i.show(),stopMaskScroll()):i.hide()},rm.hideRightMenu=function(){rm.showRightMenu(!1),$("#rightmenu-mask").attr("style","display: none")};let rmWidth=$("#rightMenu").width(),rmHeight=$("#rightMenu").height();rm.reloadrmSize=function(){rmWidth=$("#rightMenu").width(),rmHeight=$("#rightMenu").height()};let domhref="",domImgSrc="";function downloadImage(e,n){rm.hideRightMenu(),0==rm.downloadimging?(rm.downloadimging=!0,btf.snackbarShow("正在下载中，请稍后",!1,1e4),setTimeout((function(){let t=new Image;t.setAttribute("crossOrigin","anonymous"),t.onload=function(){let e=document.createElement("canvas");e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0,t.width,t.height);let i=e.toDataURL("image/png"),o=document.createElement("a"),r=new MouseEvent("click");o.download=n||"photo",o.href=i,o.dispatchEvent(r)},t.src=e,btf.snackbarShow("图片已添加盲水印，请遵守版权协议"),rm.downloadimging=!1}),"10000")):btf.snackbarShow("有正在进行中的下载，请稍后再试")}function imageToBlob(e){const n=new Image,t=document.createElement("canvas"),i=t.getContext("2d");return n.crossOrigin="",n.src=e,new Promise((e=>{n.onload=function(){t.width=this.naturalWidth,t.height=this.naturalHeight,i.drawImage(this,0,0),t.toBlob((n=>{e(n)}),"image/png",.75)}}))}async function copyImage(e){const n=await imageToBlob(e),t=new ClipboardItem({"image/png":n});navigator.clipboard.write([t])}function stopMaskScroll(){if(document.getElementById("rightmenu-mask")){document.getElementById("rightmenu-mask").addEventListener("mousewheel",(function(e){rm.hideRightMenu()}),!1)}if(document.getElementById("rightMenu")){document.getElementById("rightMenu").addEventListener("mousewheel",(function(e){rm.hideRightMenu()}),!1)}}window.oncontextmenu=function(e){if(document.body.clientWidth>768){let n=e.clientX+10,t=e.clientY,i=$(".rightMenuOther"),o=$(".rightMenuPlugin"),r=$("#menu-copytext"),c=$("#menu-commenttext"),m=$("#menu-newwindow"),h=$("#menu-copylink"),d=$("#menu-copyimg"),a=$("#menu-downloadimg"),u=$("#menu-search"),l=$("#menu-searchBaidu"),g=e.target.href,s=e.target.currentSrc,w=!1;return i.show(),selectTextNow&&window.getSelection()?(w=!0,r.show(),c.show(),u.show(),l.show(),i.hide()):(r.hide(),c.hide(),l.hide(),u.hide()),g?(w=!0,m.show(),h.show(),i.hide(),domhref=g):(m.hide(),h.hide()),s?(w=!0,d.show(),a.show(),i.hide(),domImgSrc=s):(d.hide(),a.hide()),w?o.show():o.hide(),rm.reloadrmSize(),n+rmWidth>window.innerWidth&&(n-=rmWidth+10),t+rmHeight>window.innerHeight&&(t-=t+rmHeight-window.innerHeight),rm.showRightMenu(!0,t,n),$("#rightmenu-mask").attr("style","display: flex"),!1}},rm.downloadimging=!1,rm.writeClipImg=function(e){console.log("按下复制"),rm.hideRightMenu(),btf.snackbarShow("正在下载中，请稍后",!1,1e4),0==rm.downloadimging&&(rm.downloadimging=!0,setTimeout((function(){copyImage(e),btf.snackbarShow("复制成功！图片已添加盲水印，请遵守版权协议"),rm.downloadimging=!1}),"10000"))},rm.switchDarkMode=function(){navFn.switchDarkMode(),rm.hideRightMenu()},rm.copyUrl=function(e){$("body").after("<input id='copyVal'></input>");var n=e,t=document.getElementById("copyVal");t.value=n,t.select(),t.setSelectionRange(0,t.value.length),document.execCommand("copy"),$("#copyVal").remove()},rm.rightmenuCopyText=function(e){navigator.clipboard&&navigator.clipboard.writeText(e),rm.hideRightMenu()},rm.copyPageUrl=function(){var e=window.location.href;rm.copyUrl(e),btf.snackbarShow("复制本页链接地址成功",!1,2e3),rm.hideRightMenu()};var selectTextNow="";function selceText(){var e;e=document.selection?document.selection.createRange().text:window.getSelection()+"",selectTextNow=e||""}function replaceAll(e,n,t){return e.split(n).join(t)}function addRightMenuClickEvent(){$("#menu-backward").on("click",(function(){window.history.back(),rm.hideRightMenu()})),$("#menu-forward").on("click",(function(){window.history.forward(),rm.hideRightMenu()})),$("#menu-refresh").on("click",(function(){window.location.reload()})),$("#menu-top").on("click",(function(){btf.scrollToDest(0,500),rm.hideRightMenu()})),$(".menu-link").on("click",rm.hideRightMenu),$("#menu-darkmode").on("click",rm.switchDarkMode),$("#menu-home").on("click",(function(){window.location.href=window.location.origin})),$("#rightmenu-mask").on("click",rm.hideRightMenu),$("#rightmenu-mask").contextmenu((function(){return rm.hideRightMenu(),!1})),$("#menu-translate").on("click",(function(){rm.hideRightMenu(),translateInitialization()})),$("#menu-copy").on("click",rm.copyPageUrl),$("#menu-copytext").on("click",(function(){rm.rightmenuCopyText(selectTextNow),btf.snackbarShow("复制成功，复制和转载请标注本文地址")})),$("#menu-commenttext").on("click",(function(){rm.rightMenuCommentText(selectTextNow)})),$("#menu-newwindow").on("click",(function(){window.open(domhref),rm.hideRightMenu()})),$("#menu-copylink").on("click",(function(){rm.rightmenuCopyText(domhref),btf.snackbarShow("已复制链接地址")})),$("#menu-downloadimg").on("click",(function(){downloadImage(domImgSrc,"zhheo")})),$("#menu-copyimg").on("click",(function(){rm.writeClipImg(domImgSrc)})),$("#menu-searchBaidu").on("click",rm.searchBaidu)}document.onmouseup=document.ondbclick=selceText,rm.rightMenuCommentText=function(e){rm.hideRightMenu();var n=document.getElementsByClassName("el-textarea__inner")[0];let t=document.createEvent("HTMLEvents");t.initEvent("input",!0,!0);let i=replaceAll(e,"\n","\n> ");n.value="> "+i+"\n\n",n.dispatchEvent(t);var o=document.querySelector("#post-comment").offsetTop;window.scrollTo(0,o-80),n.focus(),n.setSelectionRange(-1,-1)},rm.searchBaidu=function(){btf.snackbarShow("即将跳转到百度搜索",!1,2e3),setTimeout((function(){window.open("https://www.baidu.com/s?wd="+selectTextNow)}),"2000"),rm.hideRightMenu()};